<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 700" width="1200" height="700">
  <defs>
    <style>
      .title{font:700 56px system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;fill:#0d1b2a}
      .small{font:400 16px system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;fill:#243b53}
      .label{font:600 18px system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;fill:#102a43}
      .box{fill:#ffffff;stroke:#486581;stroke-width:2;rx:10;ry:10}
      .db{fill:#eef2f7;stroke:#486581;stroke-width:2;rx:10;ry:10}
      .queue{fill:#fff7ed;stroke:#c05621;stroke-width:2;rx:10;ry:10}
      .cache{fill:#f0fff4;stroke:#2f855a;stroke-width:2;rx:10;ry:10}
      .svc{fill:#f7faff;stroke:#3b5bdb;stroke-width:2;rx:10;ry:10}
      .arrow{stroke:#334e68;stroke-width:2;marker-end:url(#arrow)}
      .arrow-queue{stroke:#c05621;stroke-width:2;marker-end:url(#arrow)}
      .arrow-dashed{stroke:#8a8f98;stroke-width:2;stroke-dasharray:8 6;marker-end:url(#arrow-gray)}
      .legend{font:400 14px system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;fill:#486581}
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,3 L0,6 Z" fill="#334e68" />
    </marker>
    <marker id="arrow-gray" markerWidth="10" markerHeight="10" refX="10" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,3 L0,6 Z" fill="#8a8f98" />
    </marker>
  </defs>

  <text x="600" y="70" text-anchor="middle" class="title">Email Pipeline (current state)</text>
  <text x="600" y="100" text-anchor="middle" class="small">.NET 8 • MassTransit/RabbitMQ • Redis (idempotency) • PostgreSQL • OpenTelemetry • Prometheus</text>

  <!-- Client -->
  <rect x="60" y="170" width="170" height="90" class="box"/>
  <text x="145" y="225" text-anchor="middle" class="label">Client</text>

  <!-- API -->
  <rect x="290" y="160" width="220" height="110" class="svc"/>
  <text x="400" y="200" text-anchor="middle" class="label">EmailService.API</text>
  <text x="400" y="225" text-anchor="middle" class="small">ASP.NET + MassTransit</text>

  <!-- Redis -->
  <rect x="320" y="330" width="160" height="90" class="cache"/>
  <text x="400" y="375" text-anchor="middle" class="label">Redis</text>
  <text x="400" y="400" text-anchor="middle" class="small">Idempotency/Cache</text>

  <!-- RabbitMQ -->
  <rect x="570" y="170" width="170" height="90" class="queue"/>
  <text x="655" y="212" text-anchor="middle" class="label">RabbitMQ</text>
  <text x="655" y="235" text-anchor="middle" class="small">email queue</text>

  <!-- Worker -->
  <rect x="790" y="160" width="220" height="110" class="svc"/>
  <text x="900" y="200" text-anchor="middle" class="label">EmailService.Worker</text>
  <text x="900" y="225" text-anchor="middle" class="small">(stub: logs only; consumption pending)</text>

  <!-- Postgres -->
  <rect x="610" y="330" width="220" height="90" class="db"/>
  <text x="720" y="375" text-anchor="middle" class="label">PostgreSQL</text>
  <text x="720" y="400" text-anchor="middle" class="small">email persistence</text>

  <!-- OTel Collector -->
  <rect x="1020" y="330" width="150" height="90" class="box"/>
  <text x="1095" y="370" text-anchor="middle" class="label">OTel Collector</text>

  <!-- Prometheus -->
  <rect x="1020" y="460" width="150" height="90" class="box"/>
  <text x="1095" y="500" text-anchor="middle" class="label">Prometheus</text>
  <text x="1095" y="525" text-anchor="middle" class="small">scrapes the Collector</text>

  <!-- Mailhog -->
  <rect x="790" y="330" width="200" height="90" class="box"/>
  <text x="890" y="375" text-anchor="middle" class="label">Mailhog (SMTP dev)</text>
  <text x="890" y="400" text-anchor="middle" class="small">(to be used by Worker)</text>

  <!-- Flows -->
  <line x1="230" y1="215" x2="290" y2="215" class="arrow" />
  <text x="260" y="200" class="small">HTTP</text>

  <line x1="510" y1="215" x2="570" y2="215" class="arrow-queue"/>
  <text x="540" y="200" class="small">publish</text>

  <line x1="400" y1="270" x2="400" y2="330" class="arrow"/>
  <text x="405" y="305" class="small">idempotency</text>

  <line x1="510" y1="240" x2="610" y2="330" class="arrow"/>
  <text x="565" y="300" class="small">EF Core</text>

  <line x1="740" y1="215" x2="790" y2="215" class="arrow-dashed"/>
  <text x="765" y="200" class="small">consumption (planned)</text>

  <line x1="510" y1="190" x2="1020" y2="355" class="arrow"/>
  <text x="845" y="290" class="small">OTLP</text>

  <line x1="1095" y1="420" x2="1095" y2="460" class="arrow"/>
  <text x="1100" y="445" class="small">scrape</text>

  <!-- Legend -->
  <rect x="60" y="520" width="560" height="120" class="box"/>
  <text x="80" y="545" class="legend">Legend:</text>
  <circle cx="90" cy="570" r="5" fill="#334e68"/><text x="105" y="575" class="legend">solid arrow: implemented flow</text>
  <circle cx="90" cy="600" r="5" fill="#8a8f98"/><text x="105" y="605" class="legend">dashed arrow: planned (not yet in code)</text>
  <rect x="360" y="557" width="20" height="10" class="queue"/><text x="390" y="565" class="legend">RabbitMQ</text>
  <rect x="360" y="587" width="20" height="10" class="cache"/><text x="390" y="595" class="legend">Redis</text>
</svg>
